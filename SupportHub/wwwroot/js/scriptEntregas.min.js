const tooltipTriggerList = document.querySelectorAll("[data-bs-placement]"), tooltipList = [...tooltipTriggerList].map((e => new bootstrap.Tooltip(e))); function ejecutarBusqueda() { var e = $("#filtros").val(), a = $("#busqueda").val().toLowerCase(); $("#tablaEntregas tbody tr").filter((function () { var o = $(this).find("td").eq(e).text().toLowerCase(); $(this).toggle(o.indexOf(a) > -1) })) } function openModal(e, a = null) { var o = $("#formIdTipoEntrega").closest("select").prop("outerHTML"), l = $("#formIdEmpleadoEntrega").closest("select").prop("outerHTML"), t = $("#formIdEmpleadoRecibe").closest("select").prop("outerHTML"), n = $("#formIdEquipo").closest("select").prop("outerHTML"); if ($("#formIdTipoEntrega").closest("select").remove(), $("#formIdEmpleadoEntrega").closest("select").remove(), $("#formIdEmpleadoRecibe").closest("select").remove(), $("#formIdEquipo").closest("select").remove(), null === a) "agregar" === e && ($("#modalActionButton").text("Agregar"), $("#modalBody").html(`\n                <label class="col-sm-12 col-form-label">Tipo de entrega:</label>\n                <div class="col-sm-12">\n                    ${o}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Equipo:</label>\n                <div class="col-sm-12">\n                    ${n}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Cantidad:</label>\n                <div class="col-sm-12">\n                    <input type="number" class="form-control" name="cantidadEntrega" placeholder="0" id="formCantidadEntrega" />\n                </div>\n\n                <div class="alert alert-danger mt-3 mb-0" role="alert" id="alertaCantidadDisponible" style="display: none;">\n                        <i class="bi bi-exclamation-diamond-fill"></i> No hay suficiente cantidad disponible de ese equipo!\n                </div>\n\n                <label class="col-sm-12 col-form-label">Fecha:</label>\n                <div class="col-sm-12">\n                    <input type="date" class="form-control" name="fechaEntrega" id="formFechaEntrega" />\n                </div>\n\n                <label class="col-sm-12 col-form-label">Empleado entrega:</label>\n                <div class="col-sm-12">\n                    ${l}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Empleado recibe:</label>\n                <div class="col-sm-12">\n                    ${t}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Observaciones:</label>\n                <div class="col-sm-12">\n                    <textarea class="form-control" name="observacionEntrega" placeholder="Agregar observación (opcional)..." id="formObservacionEntrega" rows="3" ></textarea>\n                </div>\n            `), mostrarSelects()); else if ("modificar" === e) { $("#modalActionButton").text("Guardar"), $("#modalBody").html(`\n                <input type="hidden" id="idEntrega" name="idEntrega" value="" />\n\n                <input type="hidden" id="esModificacion" name="esModificacion" value="true" />\n\n                <label class="col-sm-12 col-form-label">Código:</label>\n                <div class="col-sm-12">\n                    <input type="text" class="form-control" id="codEntrega" name="codEntrega" >\n                </div>\n\n                <label class="col-sm-12 col-form-label">Tipo de entrega:</label>\n                <div class="col-sm-12">\n                    ${o}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Equipo:</label>\n                <div class="col-sm-12">\n                    ${n}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Cantidad:</label>\n                <div class="col-sm-12">\n                    <input type="number" class="form-control" name="cantidadEntrega" placeholder="0" id="formCantidadEntrega" />\n                </div>\n\n                <div class="alert alert-danger mt-3 mb-0" role="alert" id="alertaCantidadDisponible" style="display: none;">\n                        <i class="bi bi-exclamation-diamond-fill"></i> No hay suficiente cantidad disponible de ese equipo!\n                </div>\n\n                <label class="col-sm-12 col-form-label">Fecha:</label>\n                <div class="col-sm-12">\n                    <input type="date" class="form-control" name="fechaEntrega" id="formFechaEntrega" />\n                </div>\n\n                <label class="col-sm-12 col-form-label">Empleado entrega:</label>\n                <div class="col-sm-12">\n                    ${l}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Empleado recibe:</label>\n                <div class="col-sm-12">\n                    ${t}\n                </div>\n\n                <label class="col-sm-12 col-form-label">Observaciones:</label>\n                <div class="col-sm-12">\n                    <textarea class="form-control" name="observacionEntrega" placeholder="Agregar observación (opcional)..." id="formObservacionEntrega" rows="3" ></textarea>\n                </div>\n            `), mostrarSelects(); var i = $(a).closest("tr"); $(".modal h1").text("Modificar Entrega"), $(".modal #idEntrega").val(i.data("idEntrega")), $(".modal #codEntrega").val(i.data("codEntrega")), $(".modal #codEntrega").prop("readonly", !0), $(".modal #formIdTipoEntrega").val(i.data("idTipoEntrega")), $(".modal #formIdEquipo").val(i.data("idEquipo")), $(".modal #formCantidadEntrega").val(i.data("cantidadEntrega")), $(".modal #formFechaEntrega").val(i.data("fechaEntrega")), $(".modal #formIdEmpleadoEntrega").val(i.data("idEmpleadoEntrega")), $(".modal #formIdEmpleadoRecibe").val(i.data("idEmpleadoRecibe")), $(".modal #formObservacionEntrega").val(i.data("observacionEntrega")); var r = $(".modal #formIdEquipo option:selected"), d = parseInt($(".modal #formCantidadEntrega").val(), 10) || 0, s = parseInt(r.data("disponible"), 10) || 0, c = d + s, m = $(".modal #formIdEquipo option:selected").text(), u = m.replace(/\(\d+ disponibles\)/, "(" + c + " disponibles)"); "" === i.data("fechaDevolucion") && ($(".modal #formIdEquipo option:selected").attr("data-disponible", c).data("disponible", c), $(".modal #formIdEquipo option:selected").text(u)), localStorage.setItem("cantidadDisponibleAnterior", s), localStorage.setItem("textoAnterior", m) } else if ("eliminar" === e) { $("#modalActionButton").text("Eliminar"), $("#modalActionButton").removeClass("btn-primary"), $("#modalActionButton").addClass("btn-danger"), $("#modalBody").html(`\n                <p>¿Seguro que desea eliminar una entrega?</p>\n                <input type="hidden" name="codEntrega" id="codEntrega" value="" />\n                <input type="hidden" name="esEliminacion" id="esEliminacion" value="true" />\n                ${o}\n                ${n}\n                ${l}\n                ${t}\n            `); i = $(a).closest("tr"); $(".modal h1").text("Eliminar Entrega"), $(".modal #codEntrega").val(i.data("codEntrega")), ocultarSelects() } else if ("agregarDevolucion" === e) { $("#modalActionButton").text("Guardar"), $("#modalBody").html(`\n                <input type="hidden" name="codEntrega" id="codEntrega" value="" />\n                <input type="hidden" name="esDevolucion" id="esDevolucion" value="true" />\n\n                <label class="col-sm-12 col-form-label">Fecha devolución:</label>\n                <div class="col-sm-12">\n                    <input type="date" class="form-control" name="fechaDevolucion" id="formFechaDevolucion" />\n                </div>\n\n                ${o}\n                ${n}\n                ${l}\n                ${t}\n            `); i = $(a).closest("tr"); $(".modal h1").text("Asignar Devolución"), $(".modal #codEntrega").val(i.data("codEntrega")), ocultarSelects() } else if ("eliminarDevolucion" === e) { $("#modalActionButton").text("Eliminar"), $("#modalActionButton").removeClass("btn-primary"), $("#modalActionButton").addClass("btn-danger"), $("#modalBody").html(`\n                <p>¿Seguro que desea eliminar la fecha de devolución de la entrega?</p>\n                <input type="hidden" name="codEntrega" id="codEntrega" value="" />\n                <input type="hidden" name="esEliminacionDevolucion" id="esEliminacionDevolucion" value="true" />\n                ${o}\n                ${n}\n                ${l}\n                ${t}\n            `); i = $(a).closest("tr"); $(".modal h1").text("Eliminar Devolución"), $(".modal #codEntrega").val(i.data("codEntrega")), ocultarSelects() } } function submitFormEntregas() { if ("true" === $(".modal #esEliminacion").val()) $("#formEntregas").submit(); else if ("true" === $(".modal #esDevolucion").val()) { if ("" === $("#formFechaDevolucion").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Fecha devolución es requerido!" }), !1; $("#formEntregas").submit() } else if ("true" === $(".modal #esEliminacionDevolucion").val()) $("#formEntregas").submit(); else { if ("" === $("#formIdTipoEntrega").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Tipo de entrega es requerido!" }), !1; if ("" === $("#formIdEquipo").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Equipo es requerido!" }), !1; if ($("#formCantidadEntrega").val() <= 0) return Swal.fire({ icon: "error", title: "Oops...", text: "Cantidad debe ser mayor a 0!" }), !1; if ("" === $("#formFechaEntrega").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Fecha entrega es requerido!" }), !1; if ("" === $("#formIdEmpleadoEntrega").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Empleado entrega es requerido!" }), !1; if ("" === $("#formIdEmpleadoRecibe").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Empleado recibe es requerido!" }), !1; $("#formEntregas").submit() } } function limpiarFiltroEntregas() { $("#busqueda").val(""), $("#tablaEntregas tbody tr").show(), $("#btn-limpiar-filtro").hide(), $("#busqueda").focus().select() } function limpiarModalEntregas() { if ("true" !== $(".modal #esEliminacion").val() && "true" !== $(".modal #esEliminacionDevolucion").val() || ($("#modalActionButton").removeClass("btn-danger"), $("#modalActionButton").addClass("btn-primary")), "true" === $(".modal #esModificacion").val()) { cantidadDisponibleAnterior = localStorage.getItem("cantidadDisponibleAnterior"), textoAnterior = localStorage.getItem("textoAnterior"); var e = $(".modal #formIdEquipo option:selected"); let a = $("<option>").attr("value", e.val()).attr("data-disponible", cantidadDisponibleAnterior).text(textoAnterior); e.replaceWith(a), $(".modal #formIdEquipo").val(a.val()).trigger("change") } $("#modalEntregas h1").text("Agregar Entrega"), $("#formEntregas")[0].reset() } function mostrarSelects() { $(".modal #formIdTipoEntrega").show(), $(".modal #formIdEquipo").show(), $(".modal #formIdEmpleadoEntrega").show(), $(".modal #formIdEmpleadoRecibe").show() } function ocultarSelects() { $(".modal #formIdTipoEntrega").hide(), $(".modal #formIdEquipo").hide(), $(".modal #formIdEmpleadoEntrega").hide(), $(".modal #formIdEmpleadoRecibe").hide() } $(document).ready((function () { console.log("Document ready!"), $("#busqueda").focus().select(), null != localStorage.getItem("filtro-entregas") && $("#filtros").val(localStorage.getItem("filtro-entregas")), $("#busqueda").on("keyup", (function () { ejecutarBusqueda() })), $("#busqueda").on("input", (function () { "" === $("#busqueda").val() ? $("#btn-limpiar-filtro").hide() : $("#btn-limpiar-filtro").show() })), $("tr[data-id-entrega]").each((function () { var e = $(this), a = e.find("#fechaDevolucion"), o = e.find(".btn-edit"); "" !== a.text().trim() && (o.attr("disabled", !0), o.addClass("text-decoration-line-through")) })), $("#filtros").on("change", (function () { localStorage.setItem("filtro-entregas", $("#filtros").val()), $("#busqueda").focus().select(), ejecutarBusqueda() })), $("#formIdEquipo").on("change", (function () { $("#formCantidadEntrega").val("0") })) })), $(document).on("input", "#formCantidadEntrega", (function () { var e = parseInt($("#formCantidadEntrega").val()); !isNaN(e) && parseInt($("#formIdEquipo option:selected").data("disponible")) < e ? ($("#alertaCantidadDisponible").show(), $("#modalActionButton").attr("disabled", !0)) : ($("#alertaCantidadDisponible").hide(), $("#modalActionButton").attr("disabled", !1)) }));