const tooltipTriggerList = document.querySelectorAll("[data-bs-placement]"), tooltipList = [...tooltipTriggerList].map((o => new bootstrap.Tooltip(o))); var rowsOriginales = [], filasPorPagina = 10, paginasTotales = 0; function showImageInModal(o) { document.getElementById("modalImage").src = o, $("#imageModal").modal("show") } function mostrarPagina(o, a) { const e = rowsOriginales.filter((o => "none" !== o.style.display)); paginasTotales = Math.ceil(e.length / a); const t = document.getElementById("ticketsBody"); t.innerHTML = ""; const i = (o - 1) * a, d = Math.min(i + a, e.length); e.slice(i, d).forEach((o => { t.appendChild(o) })), actualizarPaginacion(o) } function actualizarPaginacion(o) { const a = document.querySelector(".pagination-list"); a.innerHTML = ""; for (let e = 1; e <= paginasTotales; e++) { const t = document.createElement("li"); t.className = "page-item"; const i = document.createElement("span"); i.className = "page-dot", e === o && i.classList.add("active"), i.addEventListener("click", (function () { mostrarPagina(e, filasPorPagina) })), t.appendChild(i), a.appendChild(t) } } function filtrarFilasOriginales() { const o = $(".filtro-estados span").not((function () { return $(this).attr("class").includes("-off") })), a = $(".filtro-estados .estado-todos").hasClass("estado-todos"); rowsOriginales.forEach((e => { const t = $(e), i = t.data("estado"), d = a || o.filter((function () { return $(this).text() === i })).length > 0; t.toggle(d), mostrarPagina(1, filasPorPagina) })) } function limpiarModalTickets() { $("#modalTickets h1").text("Crear Ticket"), $("#formTickets")[0].reset(), $("#previewImagenTicket").attr("src", "") } function openModal(o, a = null) { if (null === a) "agregar" === o && ($(".modal #formfechaFinalizado").hide(), $(".modal #reAbrir").hide(), $(".modal #comenzar").hide(), $(".modal label[for='formfechaFinalizado']").hide(), $(".modal #formTituloTicket").show(), $(".modal #codTicket").show(), $(".modal .agregar-modificar").show(), $(".modal label[for='formTituloTicket']").show(), $(".modal label[for='codTicket']").show(), $("#modalActionButton").text("Crear"), $(".modal h1").text("Crear Ticket"), $(".modal label[for='codTicket']").hide(), $(".modal #codTicket").hide(), $(".modal #accion").val("agregar")); else if ("modificar" === o) { $(".modal #formfechaFinalizado").hide(), $(".modal #reAbrir").hide(), $(".modal #comenzar").hide(), $(".modal label[for='formfechaFinalizado']").hide(), $(".modal #formTituloTicket").show(), $(".modal #codTicket").show(), $(".modal .agregar-modificar").show(), $(".modal label[for='formTituloTicket']").show(), $(".modal label[for='codTicket']").show(), $("#modalActionButton").text("Modificar"), $("#modalActionButton").css("background-color", "#37A668"), $(".modal #accion").val("modificar"); var e = $(a).closest("tr"); $(".modal label[for='codTicket']").show(), $(".modal #codTicket").show(), $(".modal h1").text("Modificar Ticket"), $(".modal #formTituloTicket").val(e.data("titulo")), $(".modal #codTicket").val(e.data("codigo")), $(".modal #codTicket").prop("readonly", !0), $(".modal #formDescripcionTicket").val(e.data("descripcion")), $(".modal #formFechaCreacionTicket").val(e.data("fechacreacion")), $(".modal #formIdEstado").val(e.data("idEstado")), $(".modal #formIdPrioridad").val(e.data("idPrioridad")), "" === e.data("idEmpleadoIt") ? $(".modal #formIdItResponsable").val(0) : $(".modal #formIdItResponsable").val(e.data("idEmpleadoIt")), $(".modal #idTicket").val(e.data("idTicket")), "" !== e.data("imagen") && showImageModal(e.data("imagen")) } else if ("cerrarTicket" === o) { $("#modalActionButton").text("Cerrar"), $("#modalActionButton").css({ "background-color": "#DC3545", "white-space": "nowrap" }), $(".modal #accion").val("cerrarTicket"), $(".modal .agregar-modificar").hide(), $(".modal #reAbrir").hide(), $(".modal #comenzar").hide(); const o = $(a).data("codticket"); e = $(a).closest("tr"); $(".modal #formTituloTicket").val(e.data("titulo")), $("#modalBody #codTicket").val(o); const t = (new Date).toISOString().split("T")[0]; $("#formfechaFinalizado").val(t), $(".modal h1").text("Finalizar Ticket") } else if ("reabrirTicket" === o) { e = $(a).closest("tr"); $(".modal #modalTitle").text("Reabrir Ticket"), $(".modal .agregar-modificar").hide(), $(".modal #comenzar").hide(), $(".modal #reAbrir").show(), $("#modalActionButton").text("Reabrir"), $(".modal #accion").val("reabrirTicket"); const o = $(a).data("codticket"); $("#modalBody #codTicket").val(o), $(".modal #formTituloTicket").val(e.data("titulo")), $(".modal #formTituloTicket").prop("readonly", "true"), $(".modal #formfechaFinalizado").prop("readonly", "true"), $(".modal #formfechaFinalizado").val(e.data("fechafinalizado")) } else if ("comenzarTicket" === o) { e = $(a).closest("tr"); $(".modal #formfechaFinalizado").hide(), $(".modal #reAbrir").hide(), $(".modal label[for='formfechaFinalizado']").hide(), $(".modal .agregar-modificar").hide(), $(".modal #reAbrir").hide(), $(".modal #accion").val("comenzarTicket"), $(".modal #comenzar").text("¿Seguro que va a comenzar este ticket?"), $(".modal #modalTitle").text("Comenzar Ticket"), $(".modal #formTituloTicket").show(), $(".modal #formTituloTicket").prop("readonly", "true"), $(".modal #codTicket").show(), $(".modal #comenzar").show(), $(".modal label[for='formTituloTicket']").show(), $(".modal label[for='codTicket']").show(), $("#modalActionButton").text("Comenzar"), $("#modalActionButton").css("background-color", "#d39800"); const o = $(a).data("codticket"); $("#modalBody #codTicket").val(o), $(".modal #formTituloTicket").val(e.data("titulo")) } } function previewImage(o) { var a = o.target, e = new FileReader; e.onload = function () { var o = e.result; document.getElementById("previewImagenTicket").src = o, document.getElementById("hiddenImagenBase64").value = o.split(",")[1] }, e.readAsDataURL(a.files[0]) } function showImageModal(o) { o.startsWith("data:image") || (o = "data:image/jpeg;base64," + o), document.getElementById("previewImagenTicket").src = o, $(".modal #hiddenImagenBase64").show(), document.getElementById("hiddenImagenBase64").value = o } function submitFormTickets() { let o = $("#formIdEstado").val().trim(), a = $("#formIdItResponsable").val(); if ("cerrarTicket" === $(".modal #accion").val()) { if ("" === $("#formfechaFinalizado").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Fecha finalizado es requerido!" }), !1; $("#formTickets").submit() } else if ("reabrirTicket" === $(".modal #accion").val()) $("#formTickets").submit(); else if ("comenzarTicket" === $(".modal #accion").val()) $("#formTickets").submit(); else { if ("" === $("#formTituloTicket").val().trim()) return Swal.fire({ icon: "error", title: "Oops...", text: "Título es requerido!" }), !1; if ("" === $("#formDescripcionTicket").val().trim() && ("cerrarTicket" != $(".modal #accion").val() || "reabrirTicket" != $(".modal #accion").val() || "comenzarTicket" != $(".modal #accion").val())) return Swal.fire({ icon: "error", title: "Oops...", text: "Descripción es requerido!" }), !1; if ("" === $("#formIdPrioridad").val().trim() && ("cerrarTicket" != $(".modal #accion").val() || "reabrirTicket" != $(".modal #accion").val() || "comenzarTicket" != $(".modal #accion").val())) return Swal.fire({ icon: "error", title: "Oops...", text: "Prioridad es requerida!" }), !1; if (o && "1" == o && (null == a || "" == a)) return Swal.fire({ icon: "error", title: "Oops...", text: "Asegúsere de elegir un IT responsable" }), !1; if (o && "2" === o && "" != a) return Swal.fire({ icon: "error", title: "Oops...", text: "Asegúsere de no asignar un IT responsable" }), !1 } $("#formIdEstado").prop("disabled", !1), $("#formTickets").submit() } $(document).ready((function () { rowsOriginales = Array.from(document.getElementById("ticketsBody").querySelectorAll("tr")), mostrarPagina(1, filasPorPagina), filtrarFilasOriginales() })), $(document).on("change", "#formIdItResponsable", (function () { "" !== $(this).val() ? $("#formIdEstado option").each((function () { "Asignado" === $.trim($(this).text()) && $(this).prop("selected", !0), $("#formIdEstado").prop("disabled", !0) })) : ($("#formIdEstado option").each((function () { "Abierto" === $.trim($(this).text()) && $(this).prop("selected", !0) })), $("#formIdEstado").prop("disabled", !1)) })), $(document).on("click", ".filtro-estados span", (function () { const o = $(this).text(); "Cualquiera" === o ? $("#filtroEstadoTodos").hasClass("estado-todos-off") ? ($("#filtroEstadoTodos").toggleClass("estado-todos estado-todos-off"), $("#filtroEstadoAbierto").removeClass("estado-abierto"), $("#filtroEstadoAsignado").removeClass("estado-asignado"), $("#filtroEstadoEnProceso").removeClass("estado-en-proceso"), $("#filtroEstadoCerrado").removeClass("estado-cerrado"), $("#filtroEstadoAbierto").addClass("estado-abierto-off"), $("#filtroEstadoAsignado").addClass("estado-asignado-off"), $("#filtroEstadoEnProceso").addClass("estado-en-proceso-off"), $("#filtroEstadoCerrado").addClass("estado-cerrado-off")) : $("#filtroEstadoAbierto").hasClass("estado-abierto-off") || $("#filtroEstadoAsignado").hasClass("estado-asigando-off") || $("#filtroEstadoEnProceso").hasClass("estado-en-proceso-off") || $("#filtroEstadoCerrado").hasClass("estado-en-cerrado-off") || $(this).toggleClass("estado-todos estado-todos-off") : "Abierto" === o ? ($("#filtroEstadoTodos").hasClass("estado-todos") && $("#filtroEstadoTodos").toggleClass("estado-todos estado-todos-off"), $(this).toggleClass("estado-abierto estado-abierto-off")) : "Asignado" === o ? ($("#filtroEstadoTodos").hasClass("estado-todos") && $("#filtroEstadoTodos").toggleClass("estado-todos estado-todos-off"), $(this).toggleClass("estado-asignado estado-asignado-off")) : "En Proceso" === o ? ($("#filtroEstadoTodos").hasClass("estado-todos") && $("#filtroEstadoTodos").toggleClass("estado-todos estado-todos-off"), $(this).toggleClass("estado-en-proceso estado-en-proceso-off")) : "Cerrado" === o && ($("#filtroEstadoTodos").hasClass("estado-todos") && $("#filtroEstadoTodos").toggleClass("estado-todos estado-todos-off"), $(this).toggleClass("estado-cerrado estado-cerrado-off")), filtrarFilasOriginales() }));